@if (store.loading()) {
<div class="flex justify-center items-center h-64">
  <mat-progress-spinner
    mode="indeterminate"
    [diameter]="30"
    [strokeWidth]="4"
  ></mat-progress-spinner>
</div>

} @else if (store.error()) {
<div class="flex justify-center items-center gap-4 h-48">
  <mat-icon class="text-red-500">warning</mat-icon>
  <p class="text-red-500 font-semibold">An error occured</p>
</div>
} @else {
<div class="overflow-x-auto">
  <table mat-table [dataSource]="paginatedData()" class="w-full">
    <ng-container matColumnDef="icon">
      <th mat-header-cell *matHeaderCellDef class="w-10 px-2 py-4"></th>
      <td mat-cell *matCellDef="let element" class="w-10 py-2">
        <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center">
          <svg class="w-4 h-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"
            ></path>
          </svg>
        </div>
      </td>
    </ng-container>

    <!-- Contextual Details Column -->
    <ng-container matColumnDef="context">
      <th mat-header-cell *matHeaderCellDef class="px-6 py-4"></th>
      <td mat-cell *matCellDef="let element" class="px-6 py-2">
        <div class="flex flex-col py-4">
          <span class="text-sm font-medium text-gray-800 truncate">{{ element.name }}</span>
          <span class="text-xs text-gray-500">{{ element.source }}</span>
        </div>
      </td>
    </ng-container>

    <!-- Severity Level Column -->
    <ng-container matColumnDef="severity">
      <th mat-header-cell *matHeaderCellDef class="px-6 py-4"></th>
      <td mat-cell *matCellDef="let element" class="px-6 py-4 text-right">
        <app-risk-indicator [severity]="element.severity"></app-risk-indicator>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr
      mat-row
      *matRowDef="let row; columns: displayedColumns"
      class="hover:bg-gray-50 border-b border-gray-100 last:border-b-0"
    ></tr>
  </table>
</div>

<!-- Pagination -->
<div class="flex items-center justify-center py-2 border-t border-gray-100">
  <button
    (click)="previousPage()"
    [disabled]="currentPage() === 0"
    title="Previous page"
    class="p-2 rounded-lg hover:bg-gray-100 disabled:opacity-30 transition-colors"
  >
    <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M15 19l-7-7 7-7"
      ></path>
    </svg>
  </button>

  <span class="mx-6 text-gray-600">
    Showing {{ getShowingStart() }}-{{ getShowingEnd() }} of {{ store.count() }}
  </span>
  <button
    (click)="nextPage()"
    [disabled]="currentPage() === totalPages() - 1"
    title="Next page"
    class="p-2 rounded-lg hover:bg-gray-100 disabled:opacity-30 transition-colors"
  >
    <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
    </svg>
  </button>
</div>
}
